<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>mStream Remote</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="apple-touch-icon" sizes="180x180" href="../assets/fav/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/fav/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../assets/fav/favicon-16x16.png">
  <link rel="manifest" href="../assets/fav/site.webmanifest">
  <link rel="mask-icon" href="../assets/fav/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="../assets/fav/favicon.ico">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-config" content="../assets/fav/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <!-- This empty script tag gets replaced with a preloaded variable 'sharedPlaylist' -->
  <script></script>

  <!-- mStream CSS -->
  <link rel="stylesheet" href="./index.css">
  <!-- Pure CSS -->
  <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.1/build/pure-min.css" integrity="sha384-CCTZv2q9I9m3UOxRLaJneXrrqKwUNOzZ6NGEUMwHtShDJ+nCoiXJCAgi05KfkLGY"
    crossorigin="anonymous">

   <script src="../assets/js/lib/axios.js"></script>
  <script src="../assets/js/lib/vue2.js"></script>
  <script src="./index.js"></script>

  <script>
    const remoteProperties = {
      code: 0,
      guest: false,
      error: false,
      token: false
    };

    // Function to send commands to server
    async function sendCommandToServer(command, file = false) {
      try {
        const res = await axios.post('/jukebox/push-to-client', {
          code: remoteProperties.code,
          command: command,
          file: file,
          token: remoteProperties.token
        });
      } catch (err) {
        console.log(err)
      }
    }


    // Auto Focus
    Vue.directive('focus', {
      // When the bound element is inserted into the DOM...
      inserted: function (el) {
        // Focus the element
        el.focus()
      }
    })

    window.onload = function () {
      // Prompt user for code
      // Check code against server
      // Store code



      var loginPanel = new Vue({
        el: '#login-overlay',
        data: {
          remote: remoteProperties,
        },
        methods: {
          submitCode: async function () {
            try {
              const loginCode = document.getElementById('login-code').value;
              const res = await axios.post('/jukebox/does-code-exist', { code: loginCode });
              if (res.data.status !== true) { throw 'Failed to Connect'; }

              // Initialize
              remoteProperties.error = false;
              remoteProperties.code = loginCode;
              remoteProperties.guest = res.data.guestStatus;
              remoteProperties.token = res.data.token;
              MSTREAMAPI.getCurrentDirectoryContents();
            }catch (err) {
              console.log(err)
              remoteProperties.error = 'Code Not Found';
            }
          }
        }
      });


      // Template for data items
      Vue.component('browser-item', {
        data: function () {
          return { }
        },
        template: '<div v-on:click="handleClick($event)" class="browser-item">{{displayText}}</div>',
        props: ['type', 'item'],
        methods: {
          handleClick: function (event) {
            // get data type
            var thisType = this.type;
            // do something based on data type
            if (this.type === 'file') {
              sendCommandToServer('addSong', this.item.path);
            } else if (this.type === 'directory') {
              MSTREAMAPI.goToNextDirectory(this.item.name);
            }
          },
        },
        computed: {
          displayText: function () {
            return this.item.name;
          }
        }
      });

      var browserPanel = new Vue({
        el: '#browser-container',
        data: {
          dataList: MSTREAMAPI.dataList,
          currentProperties: MSTREAMAPI.currentProperties,
          fileExplorer: MSTREAMAPI.fileExplorerArray
        },
        methods: {
          goBack: function() {
            MSTREAMAPI.goBackDirectory();
          }
        },
        computed: {
          titleText: function () {
            return 'File Explorer';
          },

          filepath: function () {
            if (this.fileExplorer.length === 1) {
              return '/';
            }

            var directoryString = '';
            for (var i = 0; i < this.fileExplorer.length; i++) {
              // Ignore root directory
              if (this.fileExplorer[i].name !== '/') {
                directoryString += "/" + this.fileExplorer[i].name;
              }
            }

            return directoryString;
          }
        }
      });
    }
  </script>
</head>

<body>
  <div v-if="remote.code === 0" id="login-overlay" class="login-overlay">
    <div class="pure-g">
      <div class="pure-u-1-3">
        <p></p>
      </div>
      <div class="pure-u-1-3">
        <img class="login-icon" src="/public/img/mstream-icon.svg">
        <form id="login-form" class="login-form" v-on:submit.prevent="submitCode($event)">
          <div>
            <label>Code</label>
            <input v-focus required type="text" class="form-control" id="login-code">
          </div>
          <button id="login-submit" type="submit" class="btn">Login</button> </form>
          <div v-show="remote.error !== false" id="login-alert" class="">{{remote.error}}</div>
      </div>
      <div class="pure-u-1-3">
        <p></p>
      </div>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <div class="logo-box">
      <img class="mstream-image" src="/public/img/mstream-logo.svg">
    </div>
  </div>

  <!-- Browser -->
  <div id="browser-container" class="browser-container">
    <!-- Browser Header -->
    <div class="browser-header">
      <div class="browser-header-text">{{titleText}}</div>
      <div class="button-group">
        <div class="repeat"></div>
        <div></div>
        <div></div>
      </div>
    </div>

    <!-- ToolBar -->
    <div class="browser-tools">
      <div v-on:click="goBack()" class="back-button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="25" height="25"><path style="text-indent:0;text-align:start;line-height:normal;text-transform:none;block-progression:tb;" d="M13.281 6.781l-8.5 8.5-.687.719.687.719 8.5 8.5 1.438-1.438L7.938 17H28v-2H7.937l6.782-6.781L13.28 6.78z" color="#000" overflow="visible"/></svg>
      </div>
      <div class="filepath">{{filepath}}</div>
    </div>

    <!-- List Area -->
    <div id="browser" class="browser">
      <div v-for="(item, index) in dataList" :item="item" :type="item.type" is="browser-item" :key="index">
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="remote-controls">
    <div onclick="sendCommandToServer('previous')" class="previous-button">
      <svg x="0" y="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" width="28" height="28" style="fill: rgb(255, 255, 255);"><g fill="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="sans-serif" font-weight="normal" font-size="12" text-anchor="start" mix-blend-mode="normal"><g><g><path d="M0,26l0,-26l26,0l0,26z" fill="none"/><g fill="#ffffff"><path d="M7,5c-0.551,0 -1,0.449 -1,1l0,14c0,0.551 0.449,1 1,1l3,0c0.551,0 1,-0.449 1,-1l0,-4.875l7.09375,5.625c0.403,0.203 0.89725,0.1705 1.28125,-0.0625c0.386,-0.232 0.625,-0.64975 0.625,-1.09375l0,-13.1875c0,-0.443 -0.239,-0.86075 -0.625,-1.09375c-0.208,-0.126 -0.4485,-0.1875 -0.6875,-0.1875c-0.201,0 -0.40875,0.033 -0.59375,0.125l-7.09375,5.625l0,-4.875c0,-0.551 -0.449,-1 -1,-1z"/></g><g fill="none"/></g></g></g></svg>
    </div>

    <div onclick="sendCommandToServer('playPause')" class="play-pause-button">
      <svg x="0" y="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" width="28" height="28" style="fill: rgb(255, 255, 255);"><g fill="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="sans-serif" font-weight="normal" font-size="12" text-anchor="start" mix-blend-mode="normal"><g><g><path d="M0,26l0,-26l26,0l0,26z" fill="none"/><g fill="#ffffff"><path d="M20.208,11.857l-13.306,-6.597c-0.403,-0.203 -0.884,-0.181 -1.268,0.052c-0.386,0.232 -0.619,0.646 -0.619,1.09l0,13.198c0,0.443 0.233,0.856 0.619,1.089c0.208,0.126 0.444,0.19 0.683,0.19c0.201,0 0.401,-0.046 0.586,-0.138l13.306,-6.599c0.438,-0.218 0.716,-0.658 0.716,-1.143c0,-0.485 -0.279,-0.924 -0.717,-1.142z"/></g></g></g></g></svg>
    </div>

    <div onclick="sendCommandToServer('next')" class="next-button">
      <svg x="0" y="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" width="28" height="28" style="fill: rgb(255, 255, 255);"><g fill="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="sans-serif" font-weight="normal" font-size="12" text-anchor="start" mix-blend-mode="normal"><g><g><path d="M0,26l0,-26l26,0l0,26z" fill="none"/><g fill="#ffffff"><path d="M16,5c-0.551,0 -1,0.449 -1,1l0,4.875l-7.09375,-5.625c-0.403,-0.203 -0.89725,-0.1705 -1.28125,0.0625c-0.386,0.232 -0.625,0.64975 -0.625,1.09375l0,13.1875c0,0.443 0.239,0.86075 0.625,1.09375c0.208,0.126 0.4485,0.1875 0.6875,0.1875c0.201,0 0.40875,-0.033 0.59375,-0.125l7.09375,-5.625l0,4.875c0,0.551 0.449,1 1,1l3,0c0.551,0 1,-0.449 1,-1l0,-14c0,-0.551 -0.449,-1 -1,-1z"/></g><g fill="none"/></g></g></g></svg>
    </div>
  </div>

</body>