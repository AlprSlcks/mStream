<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>mStream Remote</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="apple-touch-icon" sizes="180x180" href="../assets/fav/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/fav/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../assets/fav/favicon-16x16.png">
  <link rel="manifest" href="../assets/fav/site.webmanifest">
  <link rel="mask-icon" href="../assets/fav/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="../assets/fav/favicon.ico">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-config" content="../assets/fav/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <!-- This empty script tag gets replaced with a preloaded variable 'sharedPlaylist' -->
  <script></script>

  <!-- mStream CSS -->
  <link rel="stylesheet" href="./index.css">
  <!-- Pure CSS -->
  <link rel="stylesheet" href="https://unpkg.com/purecss@0.6.1/build/pure-min.css" integrity="sha384-CCTZv2q9I9m3UOxRLaJneXrrqKwUNOzZ6NGEUMwHtShDJ+nCoiXJCAgi05KfkLGY"
    crossorigin="anonymous">

   <script src="../assets/js/lib/axios.js"></script>
  <script src="../assets/js/lib/vue2.js"></script>
  <script src="./index.js"></script>

  <script>
    const remoteProperties = {
      code: 0,
      guest: false,
      error: false,
      token: false
    };

    // Function to send commands to server
    async function sendCommandToServer(command, file = false) {
      try {
        const res = await axios.post('/jukebox/push-to-client', {
          code: remoteProperties.code,
          command: command,
          file: file,
          token: remoteProperties.token
        });
      } catch (err) {
        console.log(err)
      }
    }


    // Auto Focus
    Vue.directive('focus', {
      // When the bound element is inserted into the DOM...
      inserted: function (el) {
        // Focus the element
        el.focus()
      }
    })

    window.onload = function () {
      // Prompt user for code
      // Check code against server
      // Store code



      var loginPanel = new Vue({
        el: '#login-overlay',
        data: {
          remote: remoteProperties,
        },
        methods: {
          submitCode: async function () {
            try {
              const loginCode = document.getElementById('login-code').value;
              const res = await axios.post('/jukebox/does-code-exist', { code: loginCode });
              if (res.data.status !== true) { throw 'Failed to Connect'; }

              // Initialize
              remoteProperties.error = false;
              remoteProperties.code = loginCode;
              remoteProperties.guest = res.data.guestStatus;
              remoteProperties.token = res.data.token;
              MSTREAMAPI.getCurrentDirectoryContents();
            }catch (err) {
              console.log(err)
              remoteProperties.error = 'Code Not Found';
            }
          }
        }
      });


      // Template for data items
      Vue.component('browser-item', {
        data: function () {
          return { }
        },
        template: '<div v-on:click="handleClick($event)" class="browser-item">{{displayText}}</div>',
        props: ['type', 'item'],
        methods: {
          handleClick: function (event) {
            // get data type
            var thisType = this.type;
            // do something based on data type
            if (this.type === 'file') {
              sendCommandToServer('addSong', this.item.path);
            } else if (this.type === 'directory') {
              MSTREAMAPI.goToNextDirectory(this.item.name);
            }
          },
        },
        computed: {
          displayText: function () {
            return this.item.name;
          }
        }
      });

      var browserPanel = new Vue({
        el: '#browser-container',
        data: {
          dataList: MSTREAMAPI.dataList,
          currentProperties: MSTREAMAPI.currentProperties,
          fileExplorer: MSTREAMAPI.fileExplorerArray
        },
        methods: {
          goBack: function() {
            MSTREAMAPI.goBackDirectory();
          }
        },
        computed: {
          titleText: function () {
            return 'File Explorer';
          },

          filepath: function () {
            if (this.fileExplorer.length === 1) {
              return '/';
            }

            var directoryString = '';
            for (var i = 0; i < this.fileExplorer.length; i++) {
              // Ignore root directory
              if (this.fileExplorer[i].name !== '/') {
                directoryString += "/" + this.fileExplorer[i].name;
              }
            }

            return directoryString;
          }
        }
      });
    }
  </script>
</head>

<body>
  <div v-if="remote.code === 0" id="login-overlay" class="login-overlay">
    <div class="pure-g">
      <div class="pure-u-1-3">
        <p></p>
      </div>
      <div class="pure-u-1-3">
        <?xml version="1.0" encoding="utf-8"?>
        <!-- Generator: Adobe Illustrator 20.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 612 153" style="enable-background:new 0 0 612 153;" xml:space="preserve">
        <style type="text/css">
          .st0{fill-rule:evenodd;clip-rule:evenodd;fill:#264679;}
          .st1{fill-rule:evenodd;clip-rule:evenodd;fill:#6684B2;}
          .st2{fill-rule:evenodd;clip-rule:evenodd;fill:#26477B;}
        </style>
        <g>
          <path class="st0" d="M179.9,45.5c-6.2,0-11.5,1.7-15.9,5c-4.4,3.3-6.5,8.1-6.5,14.4c0,4.9,1.3,9.1,3.8,12.4
            c2.5,3.4,5.7,5.8,9.3,7.3c3.7,1.5,7.3,2.8,11,3.8c3.7,1,6.8,2.3,9.3,3.9c2.5,1.5,3.8,3.5,3.8,5.8c0,4.8-4.4,7.2-13.1,7.2h-24.1V118
            h24.1c17.1,0,25.6-6.7,25.6-20.2c0-1.9-0.2-3.8-0.6-5.8c-0.4-2-1.2-4-2.6-6c-1.3-2.1-3.3-3.7-5.8-4.9c-2.5-1.2-6.4-2.7-11.5-4.5
            l-8.8-3.1c-0.7-0.2-1.7-0.7-2.9-1.3c-1.3-0.7-2.2-1.3-2.8-1.9c-0.6-0.6-1.1-1.4-1.6-2.3c-0.5-0.9-0.7-2-0.7-3.2c0-2,1-3.5,2.9-4.6
            c1.9-1.1,4.3-1.6,7-1.6h24.6V45.5H179.9z"/>
          <path class="st0" d="M226.4,58.3v31c0,10.2,2.5,17.6,7.6,22c5.1,4.4,13,6.6,23.7,6.6v-12.8c-2.7,0-4.9-0.2-6.8-0.4
            c-1.8-0.3-3.7-0.9-5.8-1.9c-2-0.9-3.6-2.6-4.7-4.9c-1.1-2.3-1.6-5.2-1.6-8.7V58.3h18.8V45.5h-18.8V31.6L214,58.3H226.4z"/>
          <path class="st0" d="M281.1,118V76.8c0-7.2,0.9-12,2.6-14.5c1-1.3,2.2-2.2,3.6-2.8c1.4-0.6,2.6-1,3.6-1.1c1-0.1,2.5-0.1,4.3-0.1
            H310V45.5h-12.2c-3.6,0-6.5,0.1-8.6,0.3c-2.1,0.2-4.5,0.9-7.3,2c-2.8,1.1-5.1,2.8-7.1,5c-4,4.4-6,12.4-6,24V118H281.1z"/>
          <path class="st0" d="M326.2,53.8c-6.2,7.4-9.3,17-9.3,28.9c0,10.7,3.2,19.4,9.5,26.2s14.7,10.1,25.3,10.1c8.7,0,16.3-2.7,22.7-8.1
            L366,102c-3.7,2.1-8.5,3.2-14.3,3.2c-6.5,0-11.8-2.3-15.8-6.9c-4-4.6-6-10.5-6-17.9c0-7,1.9-12.9,5.6-17.9c3.8-5,8.9-7.5,15.5-7.5
            c3.3,0,6.1,0.8,8.2,2.4c2.1,1.6,3.2,4,3.2,7.2c0,5-1.2,8.5-3.6,10.6c-2.4,2.1-6.7,3.2-12.9,3.2h-6.7v11.7h5.7
            c20.3,0,30.5-8.5,30.5-25.4c0-13.6-7.9-20.7-23.7-21.5C340.9,43,332.4,46.5,326.2,53.8z"/>
          <path class="st0" d="M412.3,73.2c-7.4,0-13.6,1.9-18.5,5.7c-4.9,3.8-7.4,9.4-7.4,16.7c0,7.3,2.3,12.9,7,16.7
            c4.6,3.8,10.9,5.7,18.8,5.7h31V73.6c0-9.1-2.4-16-7.2-20.8c-4.8-4.8-11.7-7.2-20.7-7.2h-22.9v12.8h22.3c10.9,0,16.4,6.1,16.4,18.2
            v28.7h-18.4c-9.1,0-13.6-3.2-13.6-9.8c0-3.3,1.2-5.9,3.6-7.8c2.4-1.8,5.8-2.7,10.2-2.7c5.1,0,9.4,1.4,12.9,4.3V75.3
            C420.9,73.9,416.5,73.2,412.3,73.2z"/>
          <path class="st0" d="M458.8,118H471V58.3h24.4V118h12.2V58.3h5.7c6.8,0,11.3,0.7,13.5,2c4.3,2.5,6.5,7.7,6.5,15.5V118h12.2V75.7
            c0-6-0.6-11.2-1.9-15.5c-1.2-4.3-3.9-7.8-7.9-10.6c-3.9-2.7-9.1-4.1-15.7-4.1h-61.4V118z"/>
          <polygon class="st1" points="75,118.5 75,35.5 96,48.5 96,118.5 	"/>
          <polygon class="st2" points="99,118.5 99,49.5 110.5,56.5 121,49.5 121,118.5 	"/>
          <polygon class="st1" points="124,118.5 124,48.5 145,35.5 145,118.5 	"/>
        </g>
        </svg>
        
        <form id="login-form" class="login-form" v-on:submit.prevent="submitCode($event)">
          <div>
            <label>Code</label>
            <input v-focus required type="text" class="form-control" id="login-code">
          </div>
          <button id="login-submit" type="submit" class="btn">Login</button> </form>
          <div v-show="remote.error !== false" id="login-alert" class="">{{remote.error}}</div>
      </div>
      <div class="pure-u-1-3">
        <p></p>
      </div>
    </div>
  </div>

  <!-- Header -->
  <div class="header"></div>

  <!-- Browser -->
  <div id="browser-container" class="browser-container">
    <!-- Browser Header -->
    <div class="browser-header">
      <div class="browser-header-text">{{titleText}}</div>
      <div class="button-group">
        <div class="repeat"></div>
        <div></div>
        <div></div>
      </div>
    </div>

    <!-- ToolBar -->
    <div class="browser-tools">
      <div v-on:click="goBack()" class="back-button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="25" height="25"><path d="M13.281 6.781l-8.5 8.5-.687.719.687.719 8.5 8.5 1.438-1.438L7.938 17H28v-2H7.937l6.782-6.781L13.28 6.78z" color="#000" overflow="visible"/></svg>
      </div>
      <div class="filepath">{{filepath}}</div>
    </div>

    <!-- List Area -->
    <div id="browser" class="browser">
      <div v-for="(item, index) in dataList" :item="item" :type="item.type" is="browser-item" :key="index">
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="remote-controls">
    <div onclick="sendCommandToServer('previous')" class="previous-button">
      <svg x="0" y="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" width="28" height="28" style="fill: rgb(255, 255, 255);"><g fill="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="sans-serif" font-weight="normal" font-size="12" text-anchor="start" mix-blend-mode="normal"><g><g><path d="M0,26l0,-26l26,0l0,26z" fill="none"/><g fill="#ffffff"><path d="M7,5c-0.551,0 -1,0.449 -1,1l0,14c0,0.551 0.449,1 1,1l3,0c0.551,0 1,-0.449 1,-1l0,-4.875l7.09375,5.625c0.403,0.203 0.89725,0.1705 1.28125,-0.0625c0.386,-0.232 0.625,-0.64975 0.625,-1.09375l0,-13.1875c0,-0.443 -0.239,-0.86075 -0.625,-1.09375c-0.208,-0.126 -0.4485,-0.1875 -0.6875,-0.1875c-0.201,0 -0.40875,0.033 -0.59375,0.125l-7.09375,5.625l0,-4.875c0,-0.551 -0.449,-1 -1,-1z"/></g><g fill="none"/></g></g></g></svg>
    </div>

    <div onclick="sendCommandToServer('playPause')" class="play-pause-button">
      <svg x="0" y="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" width="28" height="28" style="fill: rgb(255, 255, 255);"><g fill="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="sans-serif" font-weight="normal" font-size="12" text-anchor="start" mix-blend-mode="normal"><g><g><path d="M0,26l0,-26l26,0l0,26z" fill="none"/><g fill="#ffffff"><path d="M20.208,11.857l-13.306,-6.597c-0.403,-0.203 -0.884,-0.181 -1.268,0.052c-0.386,0.232 -0.619,0.646 -0.619,1.09l0,13.198c0,0.443 0.233,0.856 0.619,1.089c0.208,0.126 0.444,0.19 0.683,0.19c0.201,0 0.401,-0.046 0.586,-0.138l13.306,-6.599c0.438,-0.218 0.716,-0.658 0.716,-1.143c0,-0.485 -0.279,-0.924 -0.717,-1.142z"/></g></g></g></g></svg>
    </div>

    <div onclick="sendCommandToServer('next')" class="next-button">
      <svg x="0" y="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 26 26" width="28" height="28" style="fill: rgb(255, 255, 255);"><g fill="none" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="sans-serif" font-weight="normal" font-size="12" text-anchor="start" mix-blend-mode="normal"><g><g><path d="M0,26l0,-26l26,0l0,26z" fill="none"/><g fill="#ffffff"><path d="M16,5c-0.551,0 -1,0.449 -1,1l0,4.875l-7.09375,-5.625c-0.403,-0.203 -0.89725,-0.1705 -1.28125,0.0625c-0.386,0.232 -0.625,0.64975 -0.625,1.09375l0,13.1875c0,0.443 0.239,0.86075 0.625,1.09375c0.208,0.126 0.4485,0.1875 0.6875,0.1875c0.201,0 0.40875,-0.033 0.59375,-0.125l7.09375,-5.625l0,4.875c0,0.551 0.449,1 1,1l3,0c0.551,0 1,-0.449 1,-1l0,-14c0,-0.551 -0.449,-1 -1,-1z"/></g><g fill="none"/></g></g></g></svg>
    </div>
  </div>

</body>